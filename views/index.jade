doctype html
html(lang="zh_tw")
  head
    title Padnews
    link(rel="stylesheet" href="/css/han.css")
    style.
      body {
        font-family: "Fira Sans OT", "XinGothic-Citicpress", "XinGothic Citicpress", "Lantinghei TC", "Hiragino Kaku Gothic Pro", "Apple LiGothic", "Heiti TC", "LiHei Pro", "Microsoft YaHei", "微軟正黑體", "文泉驿正黑", sans-serif;
        background: url("/img/g0v-tiny.png") #16161D fixed right bottom no-repeat;
      }
      .time,
      .location {
        font-weight: bold;
      }
      .time {
        color: #f60;
      }
      .time:after,
      .location:after {
        content: ' ';
      }
      .location {
        color: #f90;
      }
      .content {
        color: white;
      }
      .empty {
        display: block;
        margin-top: 16px;
        margin-bottom: 16px;
        color: #999;
        text-decoration: none;
      }
      .empty:hover {
        color: white;
      }
  body
    - for(i=news.length-1; entry=news[i]; --i)
      section.entry
        span.time #{entry.time}
        span.location [#{entry.location}]
        //if i >= news.length-20
        for p in entry.content
          p.content #{p}
        //else
          a.empty(id="#{i}" href="#") ...
    script(src="//code.jquery.com/jquery-2.1.0.min.js")
    script(src="/socket.io/socket.io.js")
    script.
      var socket = io.connect('/');
      socket.on('patch', function(data) {
        var $sec, i;

        $sec = $('<section class="entry"><span class="time">' + data.value.time + '</span><span class="location">[' + data.value.location + ']</span></section>')
        for(i in data.value.content)
          $sec.append('<p class="content">' + data.value.content[i] + '</p>');

        i = +data.path.substr(1);
        switch(data.op) {
          case 'add':
            $('body').prepend($sec);
            break;
          case 'replace':
            $('.entry').eq(-i-1).replaceWith($sec);
            break;
          case 'remove':
            $('.entry').eq(-i-1).remove();
            break;
        }
      });

      $(".empty").click(function (e) {
        var $that = $(this);
        e.preventDefault();
        $.ajax({
          url: "/json/" + $that.attr("id"),
          dataType: "json",
          success: function (data, status) {
            var i;
            if(status !== "success") return;
            for(i in data.content)
              $that.before('<p class="content">' + data.content[i] + '</p>');
            $that.remove();
          }
        });
      });
